<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Arkitektur</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_arkitektur">Arkitektur</a>
<ul class="sectlevel2">
<li><a href="#_bakgrunn">Bakgrunn</a></li>
<li><a href="#_beslutninger">Beslutninger</a></li>
<li><a href="#_dagens_arkitektur_for_bestilling_av_automatiske_brev">Dagens arkitektur for bestilling av automatiske brev</a></li>
<li><a href="#_planlagt_arkitektur_for_brevredigering">Planlagt arkitektur for brevredigering</a></li>
</ul>
</li>
<li><a href="#_løsningsbeskrivelse_av_brevbaker_og_pdfbygger">Løsningsbeskrivelse av Brevbaker og pdfbygger</a>
<ul class="sectlevel1">
<li><a href="#_arkitektur_2">Arkitektur</a></li>
<li><a href="#_prosess_brukstilfelle">Prosess / Brukstilfelle</a>
<ul class="sectlevel2">
<li><a href="#_1_bestillersystemet_fyller_ut_en_letterrequest_med_informasjon_som_skrives_i_brevet">1. Bestillersystemet fyller ut en LetterRequest med informasjon som skrives i brevet.</a></li>
<li><a href="#_2_brevbakeren_bruker_input_data_sammen_med_malen_for_å_bestemme_innholdet_i_brevet">2. Brevbakeren bruker input data sammen med malen for å bestemme innholdet i brevet</a></li>
<li><a href="#_3_pdf_byggeren_bygger_pdf_fra_inngående_filer">3. PDF-byggeren bygger pdf fra inngående filer</a></li>
<li><a href="#_4_brevbaker_svarer_med_brev_metadata_og_pdf">4. Brevbaker svarer med brev-metadata og pdf</a></li>
</ul>
</li>
<li><a href="#_teknologivalg">Teknologivalg</a>
<ul class="sectlevel2">
<li><a href="#_github_actions">Github actions</a></li>
<li><a href="#_ktor">Ktor</a></li>
<li><a href="#_asciidoc">Asciidoc</a></li>
<li><a href="#_latex">LaTeX</a></li>
<li><a href="#_kotlin">Kotlin</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_skribenten">Skribenten</a>
<ul class="sectlevel1">
<li><a href="#_grunnleggende_scenarioer">Grunnleggende scenarioer</a></li>
<li><a href="#_brevredigering_status_diagram">Brevredigering status diagram</a></li>
</ul>
</li>
<li><a href="#_utvikling_av_brevmaler_i_brevbakeren">Utvikling av brevmaler i brevbakeren</a>
<ul class="sectlevel1">
<li><a href="#_tekst">Tekst</a>
<ul class="sectlevel2">
<li><a href="#_kun_tekst">Kun tekst</a></li>
<li><a href="#_tekst_med_variabler">Tekst med variabler</a></li>
</ul>
</li>
<li><a href="#_avsnitt">Avsnitt</a></li>
<li><a href="#_titler">Titler</a></li>
<li><a href="#_inkluderings_logikk">Inkluderings-logikk</a>
<ul class="sectlevel2">
<li><a href="#_showif">showIf</a></li>
<li><a href="#_ifnotnull">ifNotNull</a></li>
</ul>
</li>
<li><a href="#_boolske_uttrykk">Boolske uttrykk</a>
<ul class="sectlevel2">
<li><a href="#_and_or">and, or</a></li>
<li><a href="#_sammenligning">Sammenligning</a></li>
</ul>
</li>
<li><a href="#_foreach">ForEach</a></li>
<li><a href="#_ifelse">IfElse</a></li>
<li><a href="#_tabell">Tabell</a></li>
<li><a href="#_punktliste">Punktliste</a></li>
<li><a href="#_fraser">Fraser</a></li>
<li><a href="#_vedlegg">Vedlegg</a>
<ul class="sectlevel2">
<li><a href="#_inkludering_av_vedlegg_i_maler">Inkludering av vedlegg i maler</a></li>
</ul>
</li>
<li><a href="#_eksempel_på_en_enkel_mal">Eksempel på en enkel mal</a></li>
<li><a href="#_steg_for_å_lage_ett_nytt_brev">Steg for å lage ett nytt brev</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_arkitektur">Arkitektur</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bakgrunn">Bakgrunn</h3>
<div class="paragraph">
<p>Dagens brevløsning består av to systemer: Metaforce/doksys stack og HP Extreme brev.
HP Extreme bruker hovedsakelig ESB(Enterprise Service Bus) som har en rekke problemer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vanskelig å foreta endringer på grunn av systemets kompleksitet og manglende kompetanse</p>
</li>
<li>
<p>Gammelt (manglende kompetanse, manglende vedlikehold av software, dyre lisenser for legacy systemer)</p>
</li>
<li>
<p>Lite fleksibelt/lite endringspotensiale</p>
</li>
<li>
<p>Avhengig av buss og stormaskin</p>
</li>
<li>
<p>For å komme oss vekk fra HP Extreme var det besluttet å ta i bruk MetaForce for å produsere brev.</p>
</li>
<li>
<p>Arbeidet med å overføre brev fra HP Extreme til MetaForce har pågått siden 2017.</p>
</li>
<li>
<p>Det å overføre brevmaler fra ett system til ett annet er en tung og langvarig prosess, og brevmalene i seg selv er av høy verdi.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>MetaForce ønsker vi også å gå bort ifra fordi:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Team CCM har besluttet at de ikke lengre vil opprettholde MetaForce i Nav</p>
</li>
<li>
<p>Det er ett proprietært verktøy:</p>
<div class="ulist">
<ul>
<li>
<p>Kan ikke tilpasses våres behov</p>
</li>
<li>
<p>Vi er ingen garanti at MetaForce ikke stopper å få oppdateringer</p>
</li>
<li>
<p>Brevmaler låses inn i deres løsning og kan ikke automatisk overføres til nye løsninger</p>
</li>
</ul>
</div>
</li>
<li>
<p>Det forvaltes ikke av Team Pensjonsbrev, så vi er avhengig av utviklere utenfor teamet hver gang vi skal gjøre endringer i brev.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Se også: <a href="https://confluence.adeo.no/pages/viewpage.action?pageId=387091206">Oversikt - Faglige problemstillinger</a> (krever innlogging)</p>
</div>
</div>
<div class="sect2">
<h3 id="_beslutninger">Beslutninger</h3>
<div class="sect3">
<h4 id="_utvikle_brev_løsningen_selv">Utvikle brev-løsningen selv</h4>
<div class="paragraph">
<p>Det ble vurdert å ta i bruk hyllevare(OpenText Exstream), men da antar vi at vi vil støte på tidligere problemstillinger med MetaForce. OpenText Exstream er hyllevare som vi ikke kan tilpasse selv, og vi låser brev-malene inn i ett eksternt CCM verktøy slik som før. Dersom OpenText Exstream ikke vedlikeholdes er vi tilbake til samme tilstand som i dag.</p>
</div>
<div class="paragraph">
<p>Vi valgte å utvikle en egen fullstendig løsning og ikke hyllevare fordi:</p>
</div>
<div class="paragraph">
<p>Implementasjonen av brev-malene er av høy verdi. Ved å ta i bruk en egen løsning kan vi skrive malene og lagre de i en løsning vi kan vedlikeholde over lang tid.
Vi ønsker at løsningen skal vare så lenge som mulig. Ved å lage en egen løsning vil vi kunne forvalte den så lenge Nav har utviklerkapasitet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_logisk_skille_mellom_bestemmelse_av_innhold_og_rendring_av_brev">Logisk skille mellom bestemmelse av innhold og rendring av brev</h4>
<div class="paragraph">
<p>Selv om vi skriver våres egen løsning må vi ha avhengigheter til eksterne verktøy for å produsere PDF dokumenter.</p>
</div>
<div class="paragraph">
<p>For å ikke knytte oss hardt mot hvordan dokumentet vises, har vi bestemt oss for å skille produksjonen av det tekstlige innholdet i brevet fra verktøyet som produserer den endlige visningen.</p>
</div>
<div class="paragraph">
<p>Det betyr at alt innholdet i brevet bestemmes av vår egen applikasjon(brevbakeren), også overlates PDF produksjonen til et annet verktøy(LaTeX container i våres tilfelle).</p>
</div>
<div class="paragraph">
<p>Om vi ønsker å gå bort fra LaTeX i fremtiden slipper vi å skrive alle brevmalene på nytt, og vi trenger kun å lage en ny integrasjon mot ett annet verktøy.
Om vi f.eks ønsker å produsere html brev eller noe annet kan vi bare lage ett nytt visnings-lag uten å endre på koden som produserer innholdet i brevet.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dagens_arkitektur_for_bestilling_av_automatiske_brev">Dagens arkitektur for bestilling av automatiske brev</h3>
<div class="imageblock">
<div class="content">
<img src="img/dagens-arkitektur.svg" alt="dagens arkitektur" width="394" height="367">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_planlagt_arkitektur_for_brevredigering">Planlagt arkitektur for brevredigering</h3>
<div class="paragraph">
<p>Det er tiltenkt at redigering og bestilling av manuelle brev skal gjøres gjennom en dedikert applikasjon. PSAK skal lenke til denne applikasjonen.
Det skal minimeres i størst mulig grad hvilke data vi lagrer i databasen til denne nye løsningen, blant annet vil all person og saksdata overlates til Pesys og andre systemer.
Kun data om hvordan et brev evt. er endret på skal lagres, samt innstillinger for den enkelte saksbehandler.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/planlagt-arkitektur.svg" alt="planlagt arkitektur" width="848" height="610">
</div>
</div>
</div>
</div>
</div>
<h1 id="_løsningsbeskrivelse_av_brevbaker_og_pdfbygger" class="sect0">Løsningsbeskrivelse av Brevbaker og pdfbygger</h1>
<div class="paragraph">
<p>Brevbaker er en mikrotjeneste uten state som tar inn informasjon som kreves for ett brev (navn, adresse, saksnummer osv)
, og gir tilbake en PDF via REST grensesnitt. Brevbakeren bestemmer selve tekstlige innholdet i ett brev basert på brevbestillingen.</p>
</div>
<div class="paragraph">
<p>Datagrunnlaget vil variere pr brev og svarer med en pdf. Brevene vil inneholde ulik informasjon som f.eks
Verken PDF dokumentet eller informasjonen som brukes til å generere dokumentet lagres i brevbaker/pdf-bygger</p>
</div>
<div class="paragraph">
<p>Pdf-bygger er en tjeneste som mottar en liste med filer, og kompilerer de som ett LaTeX prosjekt.</p>
</div>
<div class="sect1">
<h2 id="_arkitektur_2">Arkitektur</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="moduldiagram.svg" alt="moduldiagram" width="762" height="622">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prosess_brukstilfelle">Prosess / Brukstilfelle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Overordnet vil en bestilling gå slik:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/sekvens-diagram.svg" alt="sekvens diagram" width="524" height="208">
</div>
</div>
<div class="sect2">
<h3 id="_1_bestillersystemet_fyller_ut_en_letterrequest_med_informasjon_som_skrives_i_brevet">1. Bestillersystemet fyller ut en LetterRequest med informasjon som skrives i brevet.</h3>
<div class="paragraph">
<p>(modell kan være utdatert)</p>
</div>
<hr>
<div class="imageblock">
<div class="content">
<img src="img/datagrunnlag-letterrequest.svg" alt="datagrunnlag letterrequest" width="831" height="505">
</div>
</div>
<div class="paragraph">
<p>Felles-feltet inneholder data som kreves for bestilling av alle brev. Feltene der det står "? = null" er valgfrie.
letterData feltet inneholder ulik datastruktur avhengig av hvilket brev som bestilles.
For eksempel ved bestilling av brevet "Egenerklæring godskriving omsorgspoeng" krever at letterData er inneholder malens unike grunnlag som ser slik ut:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/brevDtoEksempel.svg" alt="brevDtoEksempel" width="309" height="267">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_brevbakeren_bruker_input_data_sammen_med_malen_for_å_bestemme_innholdet_i_brevet">2. Brevbakeren bruker input data sammen med malen for å bestemme innholdet i brevet</h3>
<div class="paragraph">
<p>For å bestemme det tekstlige innholdet og elementer i brevet kombinerer vi malen med dataene. Malen er definert ved hjelp av kotlin DSL.
Malen kan se for eksempel slik ut:</p>
</div>
<details>
<summary class="title">Eksempel</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">object EksempelBrev : StaticTemplate {
    override val template = createTemplate(
        //ID på brevet
        name = "EKSEMPEL_BREV",

        //Master-mal for brevet.
        base = PensjonLatex,

        // Unik datagrunnlag/DTO for brevet
        letterDataType = EksempelBrevDto::class,

        // Hvilke språk brevet støtter
        lang = languages(Language.Bokmal),

        // Hovedtittel inne i brevet
        title = newText(Language.Bokmal to "Eksempelbrev"),

        // Metadata knyttet til en brevmal som ikke påvirker innholdet
        letterMetadata = LetterMetadata(

            // Visningstittel for ulike systemer.
            // F.eks saksbehandling brev oversikt, brukerens brev oversikt osv
            displayTitle = "Dette er ett eksempel-brev",

            // Krever brevet bankid/ nivå 4 pålogging for å vises
            isSensitiv = false,
        )
    ) {
        // Tekst-innholdet i malen
        outline {

            // Undertittel
            title1 {

                // Tekst
                text(Language.Bokmal to "Du har fått innvilget pensjon")
            }

            // Inkluder data fra datagrunnlaget til malen inn i brevet som tekst
            eval { argument().select(EksempelBrevDto::pensjonInnvilget).format() }

            // Inkludering av eksisterende frase/mini-mal for gjenbruk av elementer
            includePhrase(
                argument().select(EksempelBrevDto::pensjonInnvilget)
                    .map { TestFraseDto(it.toString()) },
                TestFrase
            )
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>Ved bruk av PensjonLatex master-malen vil det genereres en rekke filer som sendes til pdf-byggeren:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>params.tex</code> inkluderer alle felles-elementer som kreves i master-malen.</p>
</li>
<li>
<p><code>letter.xmpdata</code> inneholder metadata for pdf-dokumentet</p>
</li>
<li>
<p><code>letter.tex</code> inneholder hoveddelen av brevet med tekst og data fra brevmalen</p>
</li>
<li>
<p><code>nav-logo.pdf</code> logo for master-malen</p>
</li>
<li>
<p><code>nav-logo.pdf_tex</code> tex kode for å bruke nav logoen</p>
</li>
<li>
<p><code>pensjonsbrev_v2.cls</code> fil som beskriver plassering av innhold og utforming av brevet. Fungerer noe likt css.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_pdf_byggeren_bygger_pdf_fra_inngående_filer">3. PDF-byggeren bygger pdf fra inngående filer</h3>
<div class="paragraph">
<p>Pdf-byggeren kjører XeTeX på letter.tex filen og returnerer resulterende PDF til brevbakeren.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_brevbaker_svarer_med_brev_metadata_og_pdf">4. Brevbaker svarer med brev-metadata og pdf</h3>
<div class="paragraph">
<p>Brevbakeren svarer bestillende system med PDF og metadata som hører til brevmalen som produserte brevet definert i LetterMetadata.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_teknologivalg">Teknologivalg</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_github_actions">Github actions</h3>
<div class="paragraph">
<p>For CI/CD pipeline (kontinuerlig leveranse/integrasjon) har vi valgt github actions siden det er ett bra verktøy som mange på huset bruker.
NAIS-plattformen har også tilrettelagt for at vi lett skal kunne bruke github actions for å deploye applikasjoner til ulike miljø.</p>
</div>
<div class="paragraph">
<p>Vi bruker Github actions for å automatisere en rekke oppgaver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bygge applikasjoner og container images.</p>
</li>
<li>
<p>Unit testing, integrasjonstester og ende til ende tester.</p>
</li>
<li>
<p>Deploye til produksjon ved push til master.</p>
</li>
<li>
<p>Deploye til development ved manuell trigging av action mot branch.</p>
</li>
<li>
<p>Bygge asciidoc til html og deploye automatisk til github pages ved endringer i dokumentasjonen.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ktor">Ktor</h3>
<div class="paragraph">
<p>Ktor er ett moderne og lettvektet rammeverk for å lage http tjenester som fungerer godt sammen med Kotlin.
Vi valgte Ktor ettersom vi ønsket å bruke Kotlin og ikke har behov for tyngre rammeverk som f.eks Spring.</p>
</div>
</div>
<div class="sect2">
<h3 id="_asciidoc">Asciidoc</h3>
<div class="paragraph">
<p>Asciidoc er brukt mye i Nav og gir oss muligheten til å legge dokumentasjon nær koden. Dette gjør det lettere å legge ut endringer sammen med dokumentasjon.
Asciidoc kan også kompileres til HTML på github pages som også gjøres mange andre steder i Nav.</p>
</div>
</div>
<div class="sect2">
<h3 id="_latex">LaTeX</h3>
<div class="paragraph">
<p>Vi  har valgt LaTeX for å produsere brev/pdf-dokumenter.
LaTeX er ett typesettingssystem for produksjon av dokumenter. LaTeX er vel-etablert, Open-source, gratis og forbedret over lang tid(lansert i 1980).
Ettersom LaTeX brukes av de fleste akademiske institusjoner kan man også anta at de fleste utviklere har noe erfaring med eller kjennskap til LaTeX.
Det er viktig å understreke at vi ikke har sterke knytninger til valget av LaTeX. Vi bruker kun LaTeX for å bestemme hvordan innholdet til ett brev presenteres/vises i en pdf, ikke for å bestemme det tekstlige innholdet.
Dette gjør det mulig å bytte ut LaTeX med andre representasjoner av det tekstlige innholdet i brevet med f.eks HTML.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kotlin">Kotlin</h3>
<div class="paragraph">
<p>Kotlin er ett moderne kodespråk basert på Java som kjører i JVM. Vi bruker Kotlin ettersom det er god støtte og erfaring med Kotlin i Nav. Vi på teamet har også god erfaring med Kotlin.</p>
</div>
</div>
</div>
</div>
<h1 id="_skribenten" class="sect0">Skribenten</h1>
<div class="paragraph">
<p>Skribenten er en web applikasjon hvor saksbehandlere kan bestille, redigere og sende brev. Skribenten har full støtte for redigering av brev fra Brevbaker, samt den gjør det mulig å bestille legacy brev fra Doksys og Exstream. Skribenten består av skribenten-web (React) og skribenten-backend (Kotlin/Ktor). Skribenten-backend er i utgangspunktet ansvarlig for å videresende alle requests på vegne av skribenten-web. Videre har vi mikrotjenesten tjenestebuss-integrasjon som kjører i FSS og er ansvarlig for kommunikasjon med legacy systemer.</p>
</div>
<div class="sect1">
<h2 id="_grunnleggende_scenarioer">Grunnleggende scenarioer</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Web: skribenten-web</p>
</li>
<li>
<p>API: skribenten-backend</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/seq-diagram.svg" alt="seq diagram" width="1153" height="3097">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_brevredigering_status_diagram">Brevredigering status diagram</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/brevredigering-state.svg" alt="brevredigering state" width="473" height="512">
</div>
</div>
</div>
</div>
<h1 id="_utvikling_av_brevmaler_i_brevbakeren" class="sect0">Utvikling av brevmaler i brevbakeren</h1>
<div class="paragraph">
<p>Brevbakeren inneholder brevmaler i form av vår egen Kotlin DSL(Domain specific language)
DSL&#8217;en er utviklet for å kun inneholde de elementene vi trenger for å representere innholdet i brev i nav.</p>
</div>
<div class="paragraph">
<p>Vi har bevisst utelatt funksjonalitet som ikke direkte har med visningslogikk å gjøre, f. eks aritmetiske operasjoner for tall.</p>
</div>
<div class="paragraph">
<p>Mal-spåket er laget spesifikt for å gjøre det mindre sannsynlig at man implementerer tekniske feil i maler og at disse fører til at et brev produserers med uheldige feil og mangler. Dette inkluderer blant null-safety, slik at det ikke er mulig å bruke nullable inndata på en måte hvor man risikerer NPE eller at teksten "null" havner i produserte brev.</p>
</div>
<div class="paragraph">
<p>Informasjonsmodellen bør ta hensyn til virkelighetsbildet når det gjelder hvordan data er knyttet sammen og nullabillity. For eksempel om det ikke gir mening å ha verdi A uten verdi B så bør det vurderes om disse skal grupperes sammen (i en nøstet data-klasse). Om brevet krever en verdi C så bør den vær non-nullable slik at brevproduksjonen kan feile allerede der hvor man populerer opp informasjonsmodellen.</p>
</div>
<div class="paragraph">
<p>Denne guiden er laget for å komme i gang med mal-utvikling, men inneholder ikke en komplett liste over funksjonalitet.</p>
</div>
<div class="sect1">
<h2 id="_tekst">Tekst</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tekst er ett av de vanligste elementene i ett brev og brukes i mange ulike elementer.</p>
</div>
<div class="sect2">
<h3 id="_kun_tekst">Kun tekst</h3>
<div class="paragraph">
<p>Tekst kan defineres slik:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">// når vi kun har ren tekst og ingen variabler så bruker man text funksjonen
paragraph {
    text(
        // Her får du kompileringsfeil om du mangler tekst for språklag som påkreves av brevet/frasen/vedlegget:

        Bokmal to "Du må sende oss egenerklæring om pleie- og omsorgsarbeid",
        Nynorsk to "Du må sende oss eigenmelding om pleie- og omsorgsarbeid",
        English to "Personal declaration about the circumstances of care",

        FontType.BOLD // Optional siste parameter fontType. Default er plain. [PLAIN, BOLD, ITALIC]
    )

    // etterfølgende tekst i samme paragraph vil "henge" sammen med foregående. Det er altså opp til brev-rendering-motoren å bestemme hvordan tekst skal flytte på tverrs av linjer og sider.
    text(...)

    textExpr()
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tekst_med_variabler">Tekst med variabler</h3>
<div class="paragraph">
<p>For å bruke variabler i innhold bruker vi textExpr.
I dette tilfellet får vi da en tekst med en formattert verdi for hvilket år de utførte omsorgs-arbeid.
Tilsvarende text() så tar den også font-type som siste parameter.</p>
</div>
<div class="paragraph">
<p>Dette er ikke en funksjon som kalles ved hver bestilling, men en definisjon av en template, så verdiene vi opererer med er
Expressions(litt som promises).</p>
</div>
<div class="paragraph">
<p>For å vise variabler i ett brev så blir man tvungen til å alltid bevisst velge en måte å formattere dataene.
I eksempelet under er aarEgenerklaringOmsorgspoeng som sendes med til brevet av typen Expression&lt;no.nav.pensjon.brevbaker.api.model.Year&gt;.</p>
</div>
<div class="paragraph">
<p>Year er en IntValue, så den kan formatteres som tall. Det finnes ulike formatteringer for kroner, desimaltall, LocalDate (kort/lang format)
som hensyntar hvilket språk brevet bestilles på når den formatterer verdiene. Format gir tilbake Expression&lt;String&gt; som påkreves i textExpr.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">// gitt at aarEgenerklaringOmsorgspoeng er en Expression&lt;Year&gt; som sendes med til brevet
textExpr(
    Bokmal to
            // Om vi starter med tekst så må den gjøres om til text expr(). Vi har ikke funnet en bedre måte å få til dette på til nå.
            "Vi trenger en bekreftelse på at du har utført pleie- og omsorgsarbeid i ".expr()
            + aarEgenerklaringOmsorgspoeng.format()
            + ". Derfor må du fylle ut det vedlagte skjemaet og sende det til oss innen fire uker.",
)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_avsnitt">Avsnitt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Avsnitt deler opp innhold med mellomrom og defineres slik:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">outline {
    paragraph {
        text(Bokmal to "lipsum...",)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_titler">Titler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Utenom hoved-tittelen kan man definere titler slik:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">outline {
    title1 {
        text(
            Bokmal to "Tittel på bokmål",
        )
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inkluderings_logikk">Inkluderings-logikk</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dagens brevmaler inneholder mange styringer for å vise riktig innhold til bruker.
For å tilrettelegge for det har vi funksjonalitet for å inkludere innhold gitt.</p>
</div>
<div class="paragraph">
<p>Gitt en data-klassen til brevet er:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">data class EksempelBrevDto(val barnetillegg: Barnetillegg?){
    data class BarnetilleggFellesBarn(
        val inntektAnnenForelder: Kroner,
        val netto: Kroner,
    )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Da kan vi f.eks lage følgende logikk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">paragraph {

    // Om du har barnetillegg
    ifNotNull(barnetillegg) { tillegg -&gt;
        // og du får utbetalt barnetillegg
        showIf(tillegg.netto.greaterThan(0)) {
            textExpr(
                Bokmal to "Du får utbetalt ".expr() + tillegg.netto.format() + " Kroner i måneden i barnetillegg...",
            )
        }.orShow { // og ikke får utbetalt barnetillegg
            text(
                Bokmal to "Du får ikke utbetalt barnetillegget fordi...",
            )
        }
    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_showif">showIf</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">// Tar inn Expression&lt;Boolean&gt;, ofte som ett logisk uttrykk på samme måte som man skrive vanlige IF i kotlin
showIf(/*logikk*/) {
    ...
}.orShowIf(/*logikk*/){
    ...
}.orShow{
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ifnotnull">ifNotNull</h3>
<div class="paragraph">
<p>ifNotNull inkluderer innholdet om verdi(ene) i argumentet ikke er null.
Verdiene passeres med videre inn i blokken som garanterer at de er til stede.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">val a: Expression&lt;Kroner?&gt; = null.expr()
val b: Expression&lt;Kroner?&gt; = Kroner(100).expr()

ifNotNull(a) { kroner -&gt;
    textExpr(... kroner.format() ...)
}.orIfNotNull(b) { kroner -&gt;
    textExpr(... kroner.format() ...)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lignende logikk kan brukes nesten over alt innenfor outline. F.eks rundt rader i tabeller, hele tabeller, hele avsnitt, punkter i en liste, osv sov</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_boolske_uttrykk">Boolske uttrykk</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For å bygge opp visnings-logikk i malene må vi kunne utføre enkle logiske uttrykk i brev.
Uttrykkene må også evalueres under bruk av malen, og ikke når malen lages ved oppstart ved hjelp av Expressions</p>
</div>
<div class="sect2">
<h3 id="_and_or">and, or</h3>
<div class="paragraph">
<p>Fungerer likt som &amp;&amp; og || i kotlin, men opererer på expressions.
F.eks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">// Tar inn Expression&lt;Boolean&gt;, ofte som ett logisk uttrykk på samme måte som man skrive vanlige IF i kotlin
// gitt at a b og c er boolske verdier.
showIf(a and (b or c)) {
    ...
}. orShowIf(b) {
    ...
}.orShow {
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sammenligning">Sammenligning</h3>
<div class="paragraph">
<p>Fungerer likt som i kotlin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">showIf(
    x.greaterThan(y)
    or a.greaterThanOrEqual(b)
    or c.lessThanOrEqual(2.5)
    or d.lessThan(LocalDate.of(2020,1,1))
) {
...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_foreach">ForEach</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreach brukes for å repitere innhold for hvert element i en liste.</p>
</div>
<div class="paragraph">
<p>Gitt en data-klassen til brevet er:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">data class EksempelBrevDto(val trygdetid: List&lt;Trygdetid&gt;){
    data class Trygdetid(val fomDato: LocalDate, val tomDato: LocalDate?, val land: String)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kan vi skrive f.eks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">paragraph {
    table(...){
        forEach(trygdetid) { tt -&gt; // fungerer likt som kotlin forEach hvor tt er nåværende element
            row{
                cell{...}
            }
        }
    }
}

// Kan brukes for å repitere ulike typer innhold samme steder som conditionals kan brukes.
forEach(trygdetid) { tt -&gt;
    paragraph{
        ...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ifelse">IfElse</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ifElse brukes litt tilsvarende tertiært uttrykk(short if). Brukes ofte til å velge mellom to ord basert på en boolean.</p>
</div>
<div class="paragraph">
<p>I eksempelet under slipper man da å lage flere showif og textExpr for å</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">textExpr(
    Bokmal to "Inntekten til ".expr() + borMedSivilstand.bestemtForm() + " din har kun betydning for størrelsen på barnetillegget til "
            + ifElse(barnetilleggSaerkullsbarnGjelderFlereBarn, "barna", "barnet")
            + " som bor sammen med begge sine foreldre.",

    Nynorsk to "Inntekta til ".expr() + borMedSivilstand.bestemtForm() + " din har berre betydning for storleiken på barnetillegget til "
            + ifElse(barnetilleggSaerkullsbarnGjelderFlereBarn, "barna", "barnet")
            + " som bur saman med begge foreldra sine.",

    English to "The income of your ".expr() + borMedSivilstand.bestemtForm() + " only affects the size of the child supplement for the children who live together with both parents.",
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Uten ifElse måtte vi ha skrevet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">textExpr(
    Bokmal to "Inntekten til ".expr() + borMedSivilstand.bestemtForm() + " din har kun betydning for størrelsen på barnetillegget til "
    Nynorsk to "Inntekta til ".expr() + borMedSivilstand.bestemtForm() + " din har berre betydning for storleiken på barnetillegget til "
    English to "The income of your ".expr() + borMedSivilstand.bestemtForm() + " only affects the size of the child supplement for the children who live together with both parents.",
)

showIf(barnetilleggSaerkullsbarnGjelderFlereBarn) {
    textExpr(
        Bokmal to "barna",
        Nynorsk to "barna",
        English to "",
    )
}.orShow {
        textExpr(
        Bokmal to "barnet",
        Nynorsk to "barnet",
        English to "",
    )
}

text(
    Bokmal to " som bor sammen med begge sine foreldre.",
    Nynorsk to " som bur saman med begge foreldra sine.",
    English to "",
)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tabell">Tabell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tabeller må alltid ha en kolonne-heading, og celler kan ikke inneholde lister, tabeller eller avsnitt.
Man bør også høyre-justere tall-verdier for best mulig utseende.</p>
</div>
<div class="paragraph">
<p>Forholdstall brukes for å sette hvor mye plass i bredden en kolonne skal bruke.
Med 2 kolonner hvor en har forholdstall 2 og den andre har 1, så vil den første bruke 2/3 av plassen, altså 2:1 forhold.</p>
</div>
<div class="paragraph">
<p>Om ikke antall celler i hver rad matcher antall kolonner vil brevmalen feile ved oppstart av brevbakeren/test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">table(
    // Kolonne-spesifikasjon
    header = {
        // column(for , justering for kolonnen hvor venstre er default)
        column(2/*størrelsesforhold tall*/ ) {
            text(Bokmal to "Måned", FontType.BOLD)
        }
        column(1, RIGHT/*høyre eller venstre justering[LEFT, RIGHT], default er LEFT*/ ) {
            text(Bokmal to "Stønad", FontType.BOLD)
        }
        column(1, RIGHT) { text(Bokmal to "Pensjon", FontType.BOLD) }
        column(1, RIGHT) { text(Bokmal to "Totalt", FontType.BOLD) }
    }
) {
    row {
        cell { text(Bokmal to "Januar") }
        cell { text(Bokmal to "1 kr") }
        cell { text(Bokmal to "1 kr") }
        cell { text(Bokmal to "2 kr") }
    }
    // kontroll-strukturer som if, foreach, ifNotnull osv er også støttet her.
    showIf(...) {
        row{ ... }
    }
    row {
        ...
    }
    forEach(...){
        row { ... }
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_punktliste">Punktliste</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Punktlister er ganske rett fram. På lik måte som celler i en tabell kan de kun inneholde tekstlig innhold
og støtter kontroll-strukturer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">list {
    item {
        text(Bokmal to "en av mange ting i lista")
    }

    // Støtter også if'er, løkker osv.
    showIf(...){
        item {...}
    }.orShowIf(...) {
        ...
    }
    item {
        showIf(...){
            ...
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fraser">Fraser</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mange brev har samme innhold, så fraser er gjenbrukbart innhold man kan inkludere i flere maler.
Da blir det lettere å vedlikeholde innhold på tvers av flere brev. Akkuratt som maler kan en frase ta inn data, og innholdet defineres på samme måte
som i maler.
Om en frase ikke støtter alle språklagene som brevet rundt bruker vil man få kompilerings-feil.</p>
</div>
<div class="paragraph">
<p>F.eks i ett brev så kan man ha en outline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">outline {
    val kroner = Kroner(100).expr()
    title1 {
        text(Bokmal to "Tittel")
    }
    includePhrase(DuFaarUtbetalt(kroner))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Da kan man ha gjenbrukbar frase som tar inn f.eks kroner som parameter.
Dette definerer man i en egen fil på ett fornuftig sted under fraser pakken slik:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">data class DuFaarUtbetalt(
    val beloep: Expression&lt;Kroner&gt;,
) : OutlinePhrase&lt;LangBokmalNynorskEnglish&gt;() {
    override fun OutlineOnlyScope&lt;LangBokmalNynorskEnglish, Unit&gt;.template() {
        paragraph {
            textExpr(
                Bokmal to "Du får utbetalt ".expr() + beloep.format() + " Kroner per måned før skatt",
                Nynorsk to ...,
                English to ...,
            )
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Det finnes 3 typer fraser, hvor de kan bli inkludert ulike steder:
TextOnlyPhrase er ren tekst, og kan brukes alle steder text(&#8230;&#8203;) og textExpr(&#8230;&#8203;) kan brukes.
ParagraphPhrase kan inneholde elementer som kan brukes inne i ett avsnitt. F.eks tabeller, tekster, lister osv.
OutlinePhrase kan inneholde elementer som kan skrives i outline. F.eks title1, title2, paragraph.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vedlegg">Vedlegg</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Brev har oftest vedlegg som kommer på egne ark i pdf etter ett brev og inkluderes i vedlegg listen.
For utvikling av maler trenger man ikke å bry seg så veldig mye om hva som skjer i bakgrunnen.</p>
</div>
<div class="paragraph">
<p>Ett vedlegg defineres slik og legges på ett fornuftig sted i vedlegg pakken:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">@TemplateModelHelpers
val eksempelVedlegg = createAttachment&lt;LangBokmalNynorskEnglish, EksempelVedleggDto&gt;(
    // På samme måte som brev kan vedlegg kreve data for å produseres.
    // Vanlig mønster for disse data klassene er at de inkluderes i brev som bruker vedlegget, så alle bruker samme data klasse for vedlegget.
    // Dette gjør det enkelt å gjøre endringer i ett vedlegg som brukes på tvers av mange brev

    // På samme måte som ett brev må vedlegg ha en tittel
    title = newText(
        Bokmal to "Dine rettigheter og mulighet til å klage",
        Nynorsk to "Rettane dine og høve til å klage",
        English to "Your rights and how to appeal"
    ),
    // Setter om informasjon om bruker/verge og saksnummer skal vises på samme måte som hoved-brevet i vedlegget.
    includeSakspart = false,
) {
    // Innhold defineres på lik måte som outline
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_inkludering_av_vedlegg_i_maler">Inkludering av vedlegg i maler</h3>
<div class="paragraph">
<p>Vedlegg kan inkluderes utenfor outline ved å bruke enten includeAttachment eller includeAttachmentIfNotNull</p>
</div>
<div class="sect3">
<h4 id="_includeattachment">includeAttachment</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">{
    outline {...}
    includeAttachment(
        template = eksempelVedlegg,
        attachmentData = eksempelVedleggData
        predicate = skalHaVedlegget /*logikk som styrer om vedlegget skal produseres.*/
    )
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_includeattachmentifnotnull">includeAttachmentIfNotNull</h4>
<div class="paragraph">
<p>includeAttachmentIfNotNull inkluderer vedlegget med dataene om dataene ikke er null. Typisk bruk for denne funksjonen
er om det at vedlegget vises henger sammen med at vi har dataene. Da kan vi også garantere i vedlegget at dataene er satt.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">{
    outline {...}
    includeAttachmentIfNotNull(
        template = eksempelVedlegg,
        attachmentData = eksempelVedleggData /* hvor denne kan være null */
    )
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eksempel_på_en_enkel_mal">Eksempel på en enkel mal</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-kotlin" data-lang="kotlin">@TemplateModelHelpers // Annotasjon som gjør at malen blir plukket opp av en kode-generator. Det vil da genereres extension functions og properties basert på data-klassen som er angitt for malen som gir deg lett tilgang til feltene i en dataklasse i scopet til malen.
object OmsorgEgenAuto : AutobrevTemplate&lt;OmsorgEgenAutoDto&gt; {
    override val kode: Pesysbrevkoder.AutoBrev = Pesysbrevkoder.AutoBrev.PE_OMSORG_EGEN_AUTO // Brevkode som identifiserer dette brevet. Defineres i API-model (enum)

    override val template = createTemplate(

        // Metadata
        name = kode.name,
        letterDataType = OmsorgEgenAutoDto::class, // Data klasse for data dette brevet trenger fra api-model (utenom det som defineres i Felles())
        languages = languages(Bokmal, Nynorsk, English), // Støttede språk som type-parameter. Disse brukes for å sjekke at du har inkludert innhold for alle språk-lag ved compile-time
        letterMetadata = LetterMetadata(
            displayTitle = "", //Tittel som settes i arkivet. Det er denne tittelen som vises for saksbehandler.
            isSensitiv = false, // Setter brevet som sensitivt by default (false for auto-brev, kan hende det skal brukes for manuelle brev) Kan hende at dette feltet skal fjernes.
            distribusjonstype = LetterMetadata.Distribusjonstype.VIKTIG, // Distribusjonstype. Avgjør hvordan varslingen ved distribusjon blir. [VEDTAK,VIKTIG,ANNET]
            brevtype = VEDTAKSBREV, // VEDTAKSBREV,INFORMASJONSBREV fører til endringer i signatur/slutt-tekst og første-side
        )
    ) {
        // Her starter DSL.


        // Hoved-tittel til brevet
        title {

            // når vi kun har ren tekst og ingen variabler så bruker man text funksjonen
            text(
                // Her forventer den pairs av samme typer som definert i languages over. Da får du kompileringsfeil om du mangler en tekst på ett språklag.
                Bokmal to "Du må sende oss egenerklæring om pleie- og omsorgsarbeid",
                Nynorsk to "Du mæå sende oss eigenmelding om pleie- og omsorgsarbeid",
                English to "Personal declaration about the circumstances of care",
                FontType.BOLD // Optional siste parameter fontType. Default er plain. [PLAIN, BOLD, ITALIC]
            )
        }

        // Dette er ikke en funksjon som kalles ved hver bestilling, men en definisjon av en template, så verdiene vi opererer med er
        // Expressions(litt som promises).

        // For å vise noe i ett brev så skal det alltid bevisst velges en måte å formattere dataene.
        // Her er aarEgenerklaringOmsorgspoeng som sendes med fra  av typen Expression&lt;no.nav.pensjon.brevbaker.api.model.Year&gt;.
        // Year er en IntValue, så den kan formatteres som tall. Det finnes ulike formatteringer for kroner, desimaltall, LocalDate (kort/lang format)
        // som hensyntar hvilket språk brevet bestilles på når den formatterer verdiene. Format gir tilbake Expression&lt;String&gt;
        val aarEgenerklaringOmsorgspoeng = aarEgenerklaringOmsorgspoeng.format()


        // Outline er selve innholdet i brevet som starter på side 1 før vedleggene.
        outline {
            // I outline kan man definere titler og avsnitt
            title1 {
                text(
                    Bokmal to "Tittel",
                    Nynorsk to "Tittel",
                    English to "Title",
                )
            }
            title2 {// Under-tittel (bruk helst kun tittel 1)
                text(
                    Bokmal to "Tittel",
                    Nynorsk to "Tittel",
                    English to "Title",
                )
            }
            // Alt annet innhold må være tildelt ett avsnitt/paragraph med mellomrom til neste.

            // En del av malene våres inneholder logikk. Dette fungerer ganske likt som vanlig kotlin, men ikke helt:
            // Alt her opererer på expressions, og vi har med vilje utelatt ganging, deling og ting som faciliterer forretningslogikk.
            // Vi mener at forretnings-logikk skal foregå i høyest mulig grad utenfor brevmalen. (minst mulig beregninger).

            paragraph {
                // Her kan vi ha punktlister, tekster og tabeller.

                // For å bruke variabler i innhold bruker vi textExpr. Her tar den i mot en textExpr på alle språklagene.
                // I dette tilfellet får vi da en tekst med en formattert verdi for hvilket år de utførte omsorgs-arbeid.
                // Tilsvarende text() så tar den også font-type som siste parameter.
                textExpr(
                    Bokmal to
                            // Om vi starter med tekst så må den gjøres om til text expr(). Vi har ikke funnet en bedre måte å få til dette på til nå.
                            "Vi trenger en bekreftelse på at du har utført pleie- og omsorgsarbeid i ".expr()
                            + aarEgenerklaringOmsorgspoeng
                            + ". Derfor må du fylle ut det vedlagte skjemaet og sende det til oss innen fire uker.",

                    Nynorsk to
                            "Vi treng ei stadfesting på at du har utført pleie- og omsorgsarbeid i ".expr()
                            + aarEgenerklaringOmsorgspoeng
                            + ". Du må difor nytte det vedlagde skjemaet og sende til oss innan fire veker.",

                    English to
                            "We need you to confirm that you have provided nursing and care work in ".expr()
                            + aarEgenerklaringOmsorgspoeng
                            + ". Therefore, it is required that you complete the enclosed form and return it to Nav within four weeks.",
                )
            }
            //Her kan vi loope over en liste og repitere innhold basert på lista.
        }

        //For å inkludere vedlegg så bruker man funksjonen includeAttachment.
        //Her kan man også legge inn logikk basert på medsendte data som styrer når vedlegget skal være med.
        //Det finnes også

        includeAttachment(egenerklaeringPleieOgOmsorgsarbeid, egenerklaeringOmsorgsarbeidDto)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_steg_for_å_lage_ett_nytt_brev">Steg for å lage ett nytt brev</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For å lage ett brev i brevbakeren må man:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Oppdatere api-modell med data-klasse som definerer informasjonsbehovet til malen</p>
</li>
<li>
<p>Oppdatere api-modell med ny brevkode i Brevkode enum klassen</p>
</li>
<li>
<p>Midlertidig publisere api-modellen (kjør publish to maven local), bump api-model versjon og oppdater apiModelVersion i gradle.properties</p>
</li>
<li>
<p>Lage en fil ett fornuftig sted under maler-pakken i brevbakeren med en brevmal.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-02-20 14:40:13 UTC
</div>
</div>
</body>
</html>