name: "Build and release pensjon-brevbaker-api-model"
on:
  push:
    branches:
      - "main"
    paths:
      - "pensjon-brevbaker-api-model/**"
      - ".github/workflows/brevbaker-api-model.yaml"

jobs:
  "release":
    name: "build"
    runs-on: "ubuntu-18.04"
    steps:
      - uses: "actions/checkout@v2"
      - uses: "gradle/wrapper-validation-action@v1"
      - uses: "actions/cache@v2"
        with:
          "path": "~/.gradle/caches"
          "key": "${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle.kts') }}"
          "restore-keys": "${{ runner.os }}-gradle-"
      - uses: "actions/setup-java@v1"
        with:
          "java-version": "17"
      - name: "compile and run tests"
        run: "./gradlew :pensjon-brevbaker-api-model:build"
      - name: "Release maven artifact"
        run: "./gradlew :pensjon-brevbaker-api-model:publish"
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"