%----------------------------------------
%               Content
%----------------------------------------

% when /vspace and /addvspace are next to each other, the max value is used.
% we should then allways follow the same pattern for adding space under
% and over such that /addvspace is over and /vpsace is under each element.
% only theese two commands should be used for spacing as it disappears on page breaks.

\newboolean{previouselementwastitle}
\setboolean{previouselementwastitle}{false}

\newlength{\spacebetweentitleandnontitle}
\setlength{\spacebetweentitleandnontitle}{\dimexpr(26pt-\standardtextsize) plus 15pt minus 10pt}
\newcommand{\lettersectiontitle}[1]{
    \pagebreak[3] %strongly encourage page break before section title
    % add more space between previous non-title element accounting for it's own space )
    \ifthenelse{\boolean{previouselementwastitle}}{}{\addvspace{\spacebetweentitleandnontitle}}
    \setboolean{previouselementwastitle}{true}
    #1
    \nopagebreak
    \\[0pt]         %TODO finn en bedre måte å få \linebreak til å fungere uten å legge til indent
    \nopagebreak
    \vspace{6pt}
    \nopagebreak
}

%Letter section title
\newcommand{\lettersectiontitleone}[1]{
    \lettersectiontitle{\titleone #1}
}

\newcommand{\lettersectiontitletwo}[1]{
    \lettersectiontitle{\titletwo #1}
}

%Normal paragraphs
\newcommand{\templateparagraph}[1] {
    \standardtext
    #1
    \setboolean{previouselementwastitle}{false}
    \par
}

%----------------------------------------
%              Item list
%----------------------------------------
\newenvironment{letteritemize}[1]{
    \begin{itemize}
        #1
    } {
    \end{itemize}
    \setboolean{previouselementwastitle}{false}
}
%----------------------------------------
%                Forms
%----------------------------------------
\newcommand{\formvspace}[1][true]{\vspace{0.5cm}}

\newcommand{\formText}[1]{
    \par #1
}

% formChoice
\newlist{checklist}{itemize}{1}
\setlist[checklist]{label=$\square$}
\newenvironment{formChoice}[1]{
    \par #1
    \begin{checklist}
    } {
    \end{checklist}
    \setboolean{previouselementwastitle}{false}
}

%----------------------------------------
%                Table
%----------------------------------------
%default table settings

\definecolor{columnheadercolor}{HTML}{E6F0FF}
\definecolor{linecolor}{HTML}{E5E5E5}
\definecolor{row1color}{HTML}{F7F7F7}
\definecolor{row2color}{HTML}{FFFFFF}

\DefTblrTemplate{contfoot-text}{default}{\felttablenextpagecontinuation\hfill\space}
\DefTblrTemplate{caption}{default}{} % remove built in header
\DefTblrTemplate{capcont}{default}{\felttablecontinuedfrompreviouspage}

\newenvironment{letterTable}[1]{
    \setlength{\parskip}{0pt}
    \begin{longtblr}[presep={6mm},postsep={3.5mm},footsep={3.5mm}, headsep={3.5mm}]
    {
        colspec=#1,
        colsep = 2.5 mm,
        stretch = 0 mm, %Don't add extra space under each cell to fit the table exactly to page.
        hspan=minimal, %wrap instead of widening table over limit
        hlines={0.5mm,linecolor},
        row{odd}={row1color,rowsep=2.6mm},
        row{even}={row2color,rowsep=2.6mm},
        width=\textwidth,
        rowhead=1,
        hline{1}={0pt,linecolor}, %remove first horizontal line over the column header
        row{1-1}={columnheadercolor,rowsep=3.2mm}
    }
}{
    \end{longtblr}
    \setboolean{previouselementwastitle}{false}
}