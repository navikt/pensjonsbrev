#Used for local testing purposes
services:
  pdf-bygger:
    build: ./pdf-bygger
    environment:
      - JAVA_OPTS=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5006 -Djdk.lang.Process.launchMechanism=vfork #used for Apple M1 compatability
    ports:
      - "8081:8080"
      - "5006:5006"
  pensjon-brevbaker:
    environment:
      - PDF_BUILDER_URL=http://pdf-bygger:8080
      - AZURE_OPENID_CONFIG_JWKS_URI=http://vtp-pensjon:8060/rest/isso/oauth2/connect/jwk_uri
      - AZURE_OPENID_CONFIG_ISSUER=https://login.microsoftonline.com/966ac572-f5b7-4bbe-aa88-c76419c0f851/v2.0
      - AZURE_APP_CLIENT_ID=brevbaker-123
      - AZURE_APP_PRE_AUTHORIZED_APPS=[{"name":"pen","clientId":"123-456-789"}]
      - STS_ISSUER=http://vtp-pensjon:8060
      - STS_JWKS_URI=http://vtp-pensjon:8060/rest/isso/oauth2/connect/jwk_uri
      - STS_ACCEPTED_AUDIENCE=srvpensjon-local
      # Allows requests without auth-header #opens up debug port
      - JAVA_OPTS=-Dio.ktor.development=true -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005

    build: ./pensjon-brevbaker
    ports:
      - "8080:8080"
      - "5005:5005" # debug port
  locust-master:
    profiles:
      - locust
    image: locustio/locust
    ports:
      - "20080:20080"
    volumes:
      - ./:/mnt/locust
    command: -f /mnt/locust/locustfile.py --master -H http://locust-master:20080

  locust-worker:
    profiles:
      - locust
    image: locustio/locust
    volumes:
      - ./:/mnt/locust
    command: -f /mnt/locust/locustfile.py --worker --master-host locust-master

networks:
  default:
    name: pensjon-local