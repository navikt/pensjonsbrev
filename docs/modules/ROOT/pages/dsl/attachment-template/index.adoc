:docinfo: shared
:source-highlighter: highlight.js
:toc:

= Attachment Template

Vedleggsmaler definerer strukturen og innholdet i vedlegg.

== createAttachment

`createAttachment` definerer en vedleggsmal.

== Syntaks

[source,kotlin]
----
@TemplateModelHelpers
val mittVedlegg = createAttachment<LanguageSupport, DtoType>(
    title = newText(...),
    includeSakspart = false,
) {
    // innhold
}
----

== Parametere

[cols="2,3"]
|===
|Parameter |Beskrivelse

|`title`
|Vedleggets tittel

|`includeSakspart`
|Om brukerinfo skal vises på vedlegget

|Innhold
|Vedleggets innhold (samme DSL som outline)
|===

== Eksempel

[source,kotlin]
----
@TemplateModelHelpers
val beregningDetaljer = createAttachment<LangBokmalNynorskEnglish, BeregningDto>(
    title = newText(
        bokmal { +"Beregning av uføretrygd" },
        nynorsk { +"Utrekning av uføretrygd" },
        english { +"Calculation of disability benefit" }
    ),
    includeSakspart = false,
) {
    paragraph {
        text(
            bokmal { +"Her finner du detaljert beregning." },
            nynorsk { +"Her finn du detaljert utrekning." },
        )
    }

    title1 {
        text(bokmal { +"Grunnlag" })
    }

    paragraph {
        table(
            header = {
                column { text(bokmal { +"Type" }, FontType.BOLD) }
                column(alignment = ColumnAlignment.RIGHT) {
                    text(bokmal { +"Beløp" }, FontType.BOLD)
                }
            }
        ) {
            row {
                cell { text(bokmal { +"Grunnbeløp" }) }
                cell { eval(grunnbeloep.format()) }
            }
            row {
                cell { text(bokmal { +"Totalt" }) }
                cell { eval(maanedligBeloep.format()) }
            }
        }
    }
}
----

== includeSakspart

Styrer om brukerinformasjon vises på vedlegget:

[source,kotlin]
----
// Med brukerinfo (navn, fødselsnummer, saksnummer)
val vedleggMedSakspart = createAttachment<...>(
    title = ...,
    includeSakspart = true,
) { ... }

// Uten brukerinfo
val vedleggUtenSakspart = createAttachment<...>(
    title = ...,
    includeSakspart = false,
) { ... }
----

== Innhold

Vedlegg bruker samme DSL som `outline`:

* `paragraph` - Avsnitt
* `title1`, `title2`, `title3` - Overskrifter
* `includePhrase` - Fraser
* `showIf`, `ifNotNull`, `forEach` - Kontrollstrukturer

== Vedlegg med kompleks logikk

[source,kotlin]
----
@TemplateModelHelpers
val trygdetidVedlegg = createAttachment<LangBokmalNynorskEnglish, TrygdetidDto>(
    title = newText(bokmal { +"Din trygdetid" }),
    includeSakspart = false,
) {
    showIf(trygdetidNorge.isNotEmpty()) {
        title2 {
            text(bokmal { +"Trygdetid i Norge" })
        }

        paragraph {
            table(...) {
                forEach(trygdetidNorge) { periode ->
                    row {
                        cell { eval(periode.fom.format()) }
                        cell { eval(periode.tom.format()) }
                    }
                }
            }
        }
    }

    ifNotNull(trygdetidUtland) { utland ->
        title2 {
            text(bokmal { +"Trygdetid i utlandet" })
        }

        forEach(utland) { periode ->
            paragraph {
                text(bokmal { +periode.land + ": " + periode.aar.format() + " år" })
            }
        }
    }
}
----

== Organisering

Plasser vedlegg i `vedlegg/` pakken:

[source]
----
maler/
├── MittBrev.kt
├── fraser/
│   └── ...
└── vedlegg/
    ├── BeregningDetaljer.kt
    ├── TrygdetidOversikt.kt
    └── DineRettigheter.kt
----

== Relaterte elementer

* xref:dsl/attachment/includeAttachment.adoc[includeAttachment]
* xref:dsl/attachment/includeAttachmentIfNotNull.adoc[includeAttachmentIfNotNull]
* xref:dsl/outline/index.adoc[outline] - DSL for innhold

